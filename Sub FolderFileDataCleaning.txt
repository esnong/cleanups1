Sub FormatCSVFilesProperly()
    Dim folderPath As String
    Dim fileName As String
    Dim fullPath As String
    Dim wb As Workbook
    Dim ws As Worksheet
    Dim lineText As String
    Dim lineParts() As String
    Dim rowNum As Long, colNum As Long
    Dim fDialog As FileDialog
    Dim fileNum As Integer

    ' Ask user to select folder
    Set fDialog = Application.FileDialog(msoFileDialogFolderPicker)
    If fDialog.Show <> -1 Then Exit Sub
    folderPath = fDialog.SelectedItems(1) & "\"

    fileName = Dir(folderPath & "*.csv")

    Application.ScreenUpdating = False

    Do While fileName <> ""
        fullPath = folderPath & fileName

        ' Create new workbook
        Set wb = Workbooks.Add
        Set ws = wb.Sheets(1)

        ' Read file line by line
        fileNum = FreeFile
        Open fullPath For Input As #fileNum

        rowNum = 1
        Do While Not EOF(fileNum)
            Line Input #fileNum, lineText
            lineParts = Split(lineText, "|")

            For colNum = 0 To UBound(lineParts)
                ' Clean any stray pipes and spaces
                ws.Cells(rowNum, colNum + 1).Value = Replace(Trim(lineParts(colNum)), "|", "")
            Next colNum
            rowNum = rowNum + 1
        Loop
        Close #fileNum

        ' Save back as CSV â€” overwriting original
        Application.DisplayAlerts = False
        wb.SaveAs Filename:=fullPath, FileFormat:=xlCSV
        wb.Close SaveChanges:=False
        Application.DisplayAlerts = True

        fileName = Dir
    Loop

    Application.ScreenUpdating = True
    MsgBox "All CSV files cleaned, formatted to rows/columns, and saved!"
End Sub

