Sub SearchCSVFilesInFolder()
    Dim folderPath As String
    Dim fileName As String
    Dim searchTerm As String
    Dim wsResult As Worksheet
    Dim resultRow As Long
    Dim wbCSV As Workbook
    Dim wsCSV As Worksheet
    Dim cell As Range
    Dim rng As Range
    Dim fullPath As String
    Dim lastRow As Long, lastCol As Long
    Dim r As Long, c As Long
    Dim foundMatch As Boolean

    ' Ask for search term
    searchTerm = InputBox("Enter the text or number to search for:", "Search CSV Files")
    If searchTerm = "" Then Exit Sub

    ' Ask for folder
    With Application.FileDialog(msoFileDialogFolderPicker)
        .Title = "Select Folder with CSV Files"
        If .Show <> -1 Then Exit Sub
        folderPath = .SelectedItems(1) & "\"
    End With

    Application.ScreenUpdating = False
    Application.DisplayAlerts = False

    ' Create a new worksheet for results
    Set wsResult = ThisWorkbook.Sheets.Add
    wsResult.Name = "Search Results"
    wsResult.Cells(1, 1).Value = "File Name"
    wsResult.Cells(1, 2).Value = "Matched Row"
    resultRow = 2

    ' Loop through all CSV files
    fileName = Dir(folderPath & "*.csv")
    Do While fileName <> ""
        fullPath = folderPath & fileName
        Workbooks.OpenText Filename:=fullPath, _
            DataType:=xlDelimited, _
            Other:=True, OtherChar:="|", _
            FieldInfo:=Array(1, 2)

        Set wbCSV = ActiveWorkbook
        Set wsCSV = wbCSV.Sheets(1)

        lastRow = wsCSV.Cells(wsCSV.Rows.Count, 1).End(xlUp).Row
        foundMatch = False

        For r = 1 To lastRow
            lastCol = wsCSV.Cells(r, wsCSV.Columns.Count).End(xlToLeft).Column
            For c = 1 To lastCol
                If InStr(1, wsCSV.Cells(r, c).Text, searchTerm, vbTextCompare) > 0 Then
                    ' Match found â€” copy entire row to results
                    wsResult.Cells(resultRow, 1).Value = fileName
                    wsResult.Cells(resultRow, 2).Resize(1, lastCol).Value = wsCSV.Cells(r, 1).Resize(1, lastCol).Value
                    resultRow = resultRow + 1
                    foundMatch = True
                    Exit For
                End If
            Next c
        Next r

        wbCSV.Close SaveChanges:=False
        fileName = Dir
    Loop

    Application.DisplayAlerts = True
    Application.ScreenUpdating = True

    If resultRow = 2 Then
        MsgBox "No matches found for: " & searchTerm, vbInformation
        Application.DisplayAlerts = False
        wsResult.Delete
        Application.DisplayAlerts = True
    Else
        MsgBox "Search completed! Found " & resultRow - 2 & " matching row(s).", vbInformation
    End If

End Sub
