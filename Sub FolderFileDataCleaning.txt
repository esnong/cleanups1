Sub CleanAndFormatCSVFiles()
    Dim folderPath As String
    Dim fileName As String
    Dim fullPath As String
    Dim fileNum As Integer
    Dim lineText As String
    Dim cleanedLines As String
    Dim lineParts() As String
    Dim i As Long
    Dim fDialog As FileDialog

    ' Let user pick a folder
    Set fDialog = Application.FileDialog(msoFileDialogFolderPicker)
    If fDialog.Show <> -1 Then Exit Sub
    folderPath = fDialog.SelectedItems(1) & "\"

    fileName = Dir(folderPath & "*.csv")

    Application.ScreenUpdating = False

    Do While fileName <> ""
        fullPath = folderPath & fileName
        cleanedLines = ""

        ' Read each line from CSV
        fileNum = FreeFile
        Open fullPath For Input As #fileNum
        Do While Not EOF(fileNum)
            Line Input #fileNum, lineText
            lineParts = Split(lineText, "|")
            
            ' Clean each part (remove stray pipes inside values)
            For i = 0 To UBound(lineParts)
                lineParts(i) = Replace(lineParts(i), "|", "")
                lineParts(i) = Trim(lineParts(i))
            Next i
            
            ' Rebuild line using commas (standard CSV format)
            cleanedLines = cleanedLines & Join(lineParts, ",") & vbCrLf
        Loop
        Close #fileNum

        ' Overwrite original CSV file with cleaned content
        fileNum = FreeFile
        Open fullPath For Output As #fileNum
        Print #fileNum, cleanedLines
        Close #fileNum

        fileName = Dir
    Loop

    Application.ScreenUpdating = True
    MsgBox "All CSV files cleaned and formatted into columns!"
End Sub
