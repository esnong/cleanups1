Sub TransformEDBData()
    Dim srcSheet As Worksheet
    Dim destSheet As Worksheet
    Dim wsName As String
    Dim lastRow As Long, destRow As Long
    Dim entityType As String, personType As String
    Dim mappedEntity As String, group As String
    Dim yearCol As Long, yearVal As Long
    Dim val As Variant
    Dim i As Long

    wsName = "Transformed Output"

    ' Set source sheet
    Set srcSheet = ThisWorkbook.Sheets("EDB Claim summary")

    ' Delete existing output sheet if it exists
    Application.DisplayAlerts = False
    On Error Resume Next
    Worksheets(wsName).Delete
    On Error GoTo 0
    Application.DisplayAlerts = True

    ' Add new output sheet
    Set destSheet = ThisWorkbook.Sheets.Add
    destSheet.Name = wsName

    ' Add headers to new sheet
    With destSheet
        .Cells(1, 1).Value = "Entity"
        .Cells(1, 2).Value = "Group"
        .Cells(1, 3).Value = "Local/Foreigner"
        .Cells(1, 4).Value = "Value"
        .Cells(1, 5).Value = "Year"
    End With

    destRow = 2
    lastRow = srcSheet.Cells(srcSheet.Rows.Count, "A").End(xlUp).Row

    ' Loop through each row in source sheet
    For i = 2 To lastRow
        entityType = Trim(srcSheet.Cells(i, 1).Value)
        personType = Trim(srcSheet.Cells(i, 2).Value)

        ' Filter by person type
        If personType <> "Local" And personType <> "Foreigner" Then GoTo NextRow

        ' Match and map entity types
        Select Case entityType
            Case "- PWCS"
                mappedEntity = "PWCS CAS": group = "PWCS"
            Case "- PWCS (SHQ)"
                mappedEntity = "PWCS SHQ": group = "PWCS"
            Case "- TOS"
                mappedEntity = "TOS": group = "TOS"
            Case "- ESA"
                mappedEntity = "ESA": group = "ESA"
            Case "PWS - STA AMO"
                mappedEntity = "STA AMO": group = "STA"
            Case "PWS - STA ASE"
                mappedEntity = "STA ASE": group = "STA"
            Case Else
                GoTo NextRow
        End Select

        ' Loop through years 2022 to 2026 (columns E to I, i.e., 5 to 9)
        For yearCol = 5 To 9
            yearVal = 2022 + (yearCol - 5)
            val = srcSheet.Cells(i, yearCol).Value

            With destSheet
                .Cells(destRow, 1).Value = mappedEntity
                .Cells(destRow, 2).Value = group
                .Cells(destRow, 3).Value = personType
                .Cells(destRow, 4).Value = val
                .Cells(destRow, 5).Value = yearVal
            End With

            destRow = destRow + 1
        Next yearCol

NextRow:
    Next i

    MsgBox "Transformation complete. Output is in '" & wsName & "'.", vbInformation
End Sub
