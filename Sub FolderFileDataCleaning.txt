Sub ProcessCSVFiles_PreserveText()

    Dim folderPath As String
    Dim fileName As String
    Dim fullPath As String
    Dim wb As Workbook
    
    ' Prompt user to select a folder
    With Application.FileDialog(msoFileDialogFolderPicker)
        .Title = "Select Folder Containing CSV Files"
        If .Show <> -1 Then Exit Sub
        folderPath = .SelectedItems(1) & "\"
    End With

    Application.ScreenUpdating = False
    Application.DisplayAlerts = False

    ' Loop through each CSV file in the folder
    fileName = Dir(folderPath & "*.csv")
    Do While fileName <> ""
        fullPath = folderPath & fileName
        
        ' Open the CSV using pipe delimiter and treat all fields as text
        Workbooks.OpenText _
            Filename:=fullPath, _
            DataType:=xlDelimited, _
            Other:=True, OtherChar:="|", _
            FieldInfo:=BuildTextFieldInfo(fullPath)
        
        Set wb = ActiveWorkbook

        ' Optional: Save as Excel file or overwrite the CSV
        ' wb.SaveAs Filename:=Replace(fullPath, ".csv", "_processed.xlsx"), FileFormat:=xlOpenXMLWorkbook
        wb.Close SaveChanges:=True
        
        fileName = Dir
    Loop

    Application.DisplayAlerts = True
    Application.ScreenUpdating = True

    MsgBox "All CSV files have been processed with text preserved.", vbInformation

End Sub

Function BuildTextFieldInfo(filePath As String) As Variant
    ' Dynamically determine how many fields are in the first line
    Dim lineText As String
    Dim fileNum As Integer
    Dim columnCount As Long
    Dim i As Long
    Dim fieldInfo() As Variant

    fileNum = FreeFile
    Open filePath For Input As #fileNum
    Line Input #fileNum, lineText
    Close #fileNum

    columnCount = UBound(Split(lineText, "|")) + 1
    ReDim fieldInfo(1 To columnCount, 1 To 2)

    For i = 1 To columnCount
        fieldInfo(i, 1) = i
        fieldInfo(i, 2) = xlTextFormat  ' Force as text
    Next i

    BuildTextFieldInfo = fieldInfo
End Function
