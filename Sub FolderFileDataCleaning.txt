Sub GenerateCapexProjections()

    Dim srcSheet As Worksheet
    Dim tgtSheet As Worksheet
    Dim monthCol As Integer
    Dim lastCol As Integer
    Dim i As Long, j As Long
    Dim outputRow As Long
    Dim glAccount As String
    Dim glDescription As String
    Dim amount As Variant
    Dim monthYear As String
    Dim wsName As String
    Dim colHeader As String

    wsName = "Capex Projections"
    
    ' Set source sheet
    Set srcSheet = ThisWorkbook.Sheets("2026 LRP")
    
    ' Delete existing target sheet if it exists
    On Error Resume Next
    Application.DisplayAlerts = False
    Worksheets(wsName).Delete
    Application.DisplayAlerts = True
    On Error GoTo 0
    
    ' Create new target sheet
    Set tgtSheet = ThisWorkbook.Sheets.Add(After:=ThisWorkbook.Sheets(ThisWorkbook.Sheets.Count))
    tgtSheet.Name = wsName
    
    ' Write headers in target sheet
    tgtSheet.Cells(1, 1).Value = "GL Account"
    tgtSheet.Cells(1, 2).Value = "GL Description"
    tgtSheet.Cells(1, 3).Value = "Amount"
    tgtSheet.Cells(1, 4).Value = "Month-Year"
    
    outputRow = 2 ' Start writing from second row
    
    ' Determine last used column in row 7
    lastCol = srcSheet.Cells(7, srcSheet.Columns.Count).End(xlToLeft).Column
    
    ' Loop through columns to find month-year headers
    For j = 1 To lastCol
        colHeader = srcSheet.Cells(7, j).Value
        If IsDate(colHeader) Then
            ' Loop through GL Account rows (8 to 60)
            For i = 8 To 60
                glAccount = srcSheet.Cells(i, 3).Value
                glDescription = srcSheet.Cells(i, 4).Value
                amount = srcSheet.Cells(i, j).Value
                monthYear = Format(DateValue(colHeader), "mmm-yyyy")
                
                ' Only add if GL Account and amount are not empty
                If glAccount <> "" And IsNumeric(amount) Then
                    tgtSheet.Cells(outputRow, 1).Value = glAccount
                    tgtSheet.Cells(outputRow, 2).Value = glDescription
                    tgtSheet.Cells(outputRow, 3).Value = amount
                    tgtSheet.Cells(outputRow, 4).Value = monthYear
                    outputRow = outputRow + 1
                End If
            Next i
        End If
    Next j
    
    ' Format as a table
    Dim tblRange As Range
    Set tblRange = tgtSheet.Range("A1:D" & outputRow - 1)
    tgtSheet.ListObjects.Add(xlSrcRange, tblRange, , xlYes).Name = "CapexTable"
    
    MsgBox "Capex Projections sheet has been created successfully.", vbInformation

End Sub
