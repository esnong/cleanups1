Sub SearchAcrossExcelFilesFromRow2()
    Dim folderPath As String
    Dim fileName As String
    Dim searchValue As Variant
    Dim wsDest As Worksheet
    Dim destRow As Long
    Dim wbSource As Workbook
    Dim wsSource As Worksheet
    Dim matchFound As Boolean
    Dim lastRow As Long
    Dim lastCol As Long
    Dim cell As Range
    Dim headerCopied As Boolean

    ' Set destination worksheet
    Set wsDest = ThisWorkbook.Sheets(1)
    
    ' Clear old results, but keep cell B1 intact
    wsDest.Range("A3:Z10000").ClearContents
    destRow = 3 ' Start output from row 3

    ' Get search value from B1
    searchValue = wsDest.Range("B1").Value
    If searchValue = "" Then
        MsgBox "Please enter a search value in cell B1.", vbExclamation
        Exit Sub
    End If

    ' Prompt folder selection
    With Application.FileDialog(msoFileDialogFolderPicker)
        .Title = "Select a folder containing Excel files"
        If .Show <> -1 Then Exit Sub
        folderPath = .SelectedItems(1) & "\"
    End With

    Application.ScreenUpdating = False

    ' Search for Excel files
    fileName = Dir(folderPath & "*.xls*")
    Do While fileName <> ""
        If fileName <> ThisWorkbook.Name Then
            Set wbSource = Workbooks.Open(folderPath & fileName, False, True) ' Read-only
            Set wsSource = wbSource.Sheets(1)
            
            matchFound = False
            headerCopied = False

            lastRow = wsSource.Cells(wsSource.Rows.Count, 1).End(xlUp).Row
            lastCol = wsSource.Cells(1, wsSource.Columns.Count).End(xlToLeft).Column

            ' Start from row 2
            For Each cell In wsSource.Range(wsSource.Cells(2, 1), wsSource.Cells(lastRow, lastCol))
                If cell.Value = searchValue Then
                    If Not headerCopied Then
                        ' Copy header (row 1)
                        wsSource.Range(wsSource.Cells(1, 1), wsSource.Cells(1, lastCol)).Copy wsDest.Cells(destRow, 1)
                        destRow = destRow + 1
                        headerCopied = True
                    End If
                    ' Copy matched row
                    wsSource.Range(wsSource.Cells(cell.Row, 1), wsSource.Cells(cell.Row, lastCol)).Copy wsDest.Cells(destRow, 1)
                    destRow = destRow + 1
                    matchFound = True
                End If
            Next cell

            If matchFound Then
                destRow = destRow + 1 ' Add blank row between results
            End If

            wbSource.Close False
        End If
        fileName = Dir
    Loop

    Application.ScreenUpdating = True
    MsgBox "Search across Excel files complete!", vbInformation
End Sub
