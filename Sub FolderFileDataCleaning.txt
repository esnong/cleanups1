Sub AppendDataToFiles()
    Dim SourceFolder As String, DestinationFolder As String
    Dim SourceFile As String, DestinationFile As String
    Dim wbSource As Workbook, wbDestination As Workbook
    Dim wsSource As Worksheet, wsDestination As Worksheet
    Dim LastRow As Long, AppendRow As Long
    Dim FileParts() As String, Identifier As String
    Dim FolderPicker As FileDialog
    
    ' Ask user to select source folder
    Set FolderPicker = Application.FileDialog(msoFileDialogFolderPicker)
    With FolderPicker
        .Title = "Select Source Folder Containing Excel Files"
        .AllowMultiSelect = False
        If .Show <> -1 Then Exit Sub
        SourceFolder = .SelectedItems(1) & "\"
    End With
    
    ' Ask user to select destination folder
    Set FolderPicker = Application.FileDialog(msoFileDialogFolderPicker)
    With FolderPicker
        .Title = "Select Destination Folder for Consolidation"
        .AllowMultiSelect = False
        If .Show <> -1 Then Exit Sub
        DestinationFolder = .SelectedItems(1) & "\"
    End With
    
    ' Process each Excel file in the source folder
    SourceFile = Dir(SourceFolder & "*.xlsx")
    Do While SourceFile <> ""
        ' Extract identifier from filename (format: mmm_xxxxxx_yyyy)
        FileParts = Split(SourceFile, "_")
        If UBound(FileParts) >= 1 Then
            Identifier = FileParts(1) ' Extract the xxxxxx part
        Else
            SourceFile = Dir
            Continue Do ' Skip to next file
        End If
        
        ' Define the corresponding destination file path
        DestinationFile = DestinationFolder & Identifier & ".xlsx"
        
        ' Open the source workbook
        Set wbSource = Workbooks.Open(SourceFolder & SourceFile)
        Set wsSource = wbSource.Sheets(1) ' Assuming data is in the first sheet
        
        ' Remove header row from source data
        wsSource.Rows(1).Delete Shift:=xlUp
        
        ' Open or create the destination workbook
        If Dir(DestinationFile) <> "" Then
            Set wbDestination = Workbooks.Open(DestinationFile)
        Else
            Set wbDestination = Workbooks.Add
            wbDestination.Sheets(1).Name = "Sheet1"
            wbDestination.SaveAs DestinationFile
        End If
        Set wsDestination = wbDestination.Sheets(1)
        
        ' Find the last row in source and destination sheets
        LastRow = wsSource.Cells(wsSource.Rows.Count, 1).End(xlUp).Row
        AppendRow = wsDestination.Cells(wsDestination.Rows.Count, 1).End(xlUp).Row + 1
        
        ' Copy data from source and append to destination
        If LastRow >= 1 Then
            wsSource.Range("A1:Z" & LastRow).Copy
            wsDestination.Cells(AppendRow, 1).PasteSpecial Paste:=xlPasteValues
            Application.CutCopyMode = False
        End If
        
        ' Save and close workbooks
        wbDestination.Save
        wbDestination.Close False
        wbSource.Close False
        
        ' Get next file
        SourceFile = Dir
    Loop
    
    MsgBox "All files have been successfully appended!", vbInformation
End Sub
